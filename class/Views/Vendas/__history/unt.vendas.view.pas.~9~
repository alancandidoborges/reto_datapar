unit unt.vendas.view;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS,
  FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Comp.DataSet,
  FireDAC.Comp.Client, Vcl.Grids, Vcl.DBGrids, Vcl.Buttons, Vcl.StdCtrls,
  Vcl.ExtCtrls, unt.inc.vendas, unt.pedido.service, unt.TipoOperacion.Enum;

type
  TfrmVendas = class(TForm)
    pnTop: TPanel;
    lblNombreBentana: TLabel;
    pnCenter: TPanel;
    pnButton: TPanel;
    SpeedButton2: TSpeedButton;
    Panel1: TPanel;
    SpeedButton1: TSpeedButton;
    SpeedButton3: TSpeedButton;
    SpeedButton4: TSpeedButton;
    DBGrid1: TDBGrid;
    FDMemPrincipal: TFDMemTable;
    DS_Principal: TDataSource;
    FDMemPrincipalID: TFMTBCDField;
    FDMemPrincipalCODIGOCLI: TFMTBCDField;
    FDMemPrincipalNOMBRE: TStringField;
    FDMemPrincipalDATA_ENTREGA: TDateTimeField;
    FDMemPrincipalDATA_INC: TDateTimeField;
    FDMemPrincipalVALOR_TOTAL: TBCDField;
    procedure SpeedButton1Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure SpeedButton3Click(Sender: TObject);
    procedure SpeedButton2Click(Sender: TObject);
  private

    FPedidoService : TPedidoService;
    FPedidos       : TFDQuery;

    procedure CrearDataSet;

  public
    procedure CargaDatos;

  end;

var
  frmVendas: TfrmVendas;

implementation

{$R *.dfm}

{ TfrmVendas }

procedure TfrmVendas.CargaDatos;
begin
  FPedidos := FPedidoService.LoadGrid;
  FPedidos.FetchAll;
  FDMemPrincipal.Close;
  FDMemPrincipal.Filter := EmptyStr;
  FDMemPrincipal.Data   := FPedidos.Data;
  FDMemPrincipal.Open;
end;

procedure TfrmVendas.CrearDataSet;
begin
  FDMemPrincipal.Close;
  FDMemPrincipal.CreateDataSet;
  FDMemPrincipal.Open;
  FDMemPrincipal.EmptyDataSet;
end;

procedure TfrmVendas.FormCreate(Sender: TObject);
begin
  FPedidoService := TPedidoService.Create;
  FPedidos       := TFDQuery.Create(nil);
end;

procedure TfrmVendas.FormDestroy(Sender: TObject);
begin
  FPedidoService.DisposeOf;
end;

procedure TfrmVendas.FormShow(Sender: TObject);
begin
  CargaDatos();
end;

procedure TfrmVendas.SpeedButton1Click(Sender: TObject);
begin
  Application.CreateForm(TfrmIncVendas, frmIncVendas);
  frmIncVendas.TipoOperacion := toIncluir;
  frmIncVendas.ShowModal;
end;
procedure TfrmVendas.SpeedButton2Click(Sender: TObject);
begin
  Close;
end;

procedure TfrmVendas.SpeedButton3Click(Sender: TObject);
begin
  Application.CreateForm(TfrmIncVendas, frmIncVendas);
  frmIncVendas.TipoOperacion := toAlterar;
  frmIncVendas.Codigo := FDMemPrincipal.FieldByName('ID').AsInteger;
  frmIncVendas.ShowModal;
end;

end.
